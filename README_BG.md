# Система за разпределение на легла в болници


# Относно Проекта

Този проект създава система за обновяване и наблюдаване на промени в свободните легла на болници и техните отделения. Той дава възможност на администратори на болници да правят бързи промени в настоящите ресурси, а на потребителя (потенциален клиент на болницата) бърз начин да разбере коя болница има най-много свободни легла и колко.
Този проект е направен заради растящият борй хора в България, които е трябвало да минат през 4 или повече болници преди да бъдат допуснати или докато не умрат. Дори и медици от бърза помощ нямат бърз начин да разжерат коя болница има свободни легла.

## Възможни Клиенти

Този проект е насочен към държави, провинции или щати без настояща система, която да може бързо да предостави такъв вид информация до населението.

## Изготвено с:

* [Google Cloud](https://cloud.google.com/)

* [Firebase](https://firebase.google.com/)

* [Spring](https://spring.io/)

# Да започнем:

Този проект не е локален и е напълно облачно-остроен..

## Преди да използвате този проект ще ви трябва Firebase база от данни и Google Cloud проект.

* Service account
  * Влезте във Firebase и отворете вашият проект
  * Идете в Project Settings (колелцето до Project Overview)
  * Минете в Service Accounts
  * Натизнете generate new private key и го свалете

# Инсталация:

	Google Authentication
Проектът използва Google Authentication. За да работи, трябва да се следват няколко стъпки за да се активира OAuth2.

	Идедте в Google APIs и отворете credentials.
	Създайте нов client ID и приложете своят Google App Engine URL като авторизиран redirect URL:
	Пример: http://your-app-engine-url/login/oauth2/code/google

Осигурете се, че сте добавили последната част.
Свалете credential-ите.

	Качване в Google Cloud
Качете проектът в Google App Engine по един от следните начини:

	Локално:
	
Свалете папката "Server" и я качете директно към папката ви в Google App Engine.
Добавете serviceAccount.json в /resources папката
Създайте файл application.properties в /resources папката и прибавете Google Client ID информацията:
spring.security.oauth2.client.registration.google.client-id=client-id spring.security.oauth2.client.registration.google.client-secret=secret-key
След това преминете в powershell и минете в “Server” директорията, след което въведете.

mvn spring-boot:run

gcloud app deploy

	През Github
	
Минете в Google App Engine power shell и въведете:

git clone https://github.com/ispirovjr/Onlympiad2020.git

-Останалите стъпки са същите.

След това програмата трябва да е достъпна през URL линка на Google Could. 
Note: Препоръчително е в app.yaml да се промени instance_class на F2 за повече мощност.

	Преди да го отворите
Преди да отворите апликацията поне три firebase collections трябва да бъдат създадени- "hospitals", "users" and "audit".

	Hospitals
		Имената на отделите във всяка болница трябва да бъдат доважени като документи.
		Също името на болницата на отделението трябва да се добави като текстово поле наименувано "hospital".
		Ако болницата има само едно отделение, то името на болницата и отделението могат да съвпадат.
		(optional) Името на отделението може да се добави цифрено, като цифрите отговарят на следните:
			0: Empty - използва се когато друг номер не е въведен
			1: Covid Specific - отделение специфично за пациенти, бокни от Ковид-19.
			2: Emergency - спешното отделение на болницата
			3: Converted - което и да е друго отделение, което се използва за различни цели
		Останалите полета могат да се добавят и променят от фронтенда.
	Users
		Потребителите (администрация в болницата) трябва да се добавят индивидуално с техните имейли.
		Всеки потребител трябва да има поне 2 полете:
			"email" - имейлът им (като поле, отделно от името)
			"hospital" - болницата, в която работят
			(Optional) ID - или IDто им в болницата или даденото им от OAuth2 
	Audit
		Тази графа може да се остави празна, защото тя ще се попълни по-късно
		Дори и да е празна, тя трябва да се създаде предварително

	Използване
След като Spring апликацията е вдигната следните линкове са от значение:

За оросяване първата част от URL не е включена.

	"/Admin/index.html" - това е администраторският портал
		След го отвори, потребителят ще бъде помолен да влезе в своят Google профил. Моля използвайте профилът, чийто имейл е базата от данни
		Когато потребителят влезе с правилният имейл, апликацията сама ще зареди болницата, в която те работят (въведено в базата от данни)
		Тук ще излязат всички отделения, които са били добавени към болницата (в полето “hospital” в базата от данни)
		Сега потребителят може да промени който и да е от трите полета "Total Beds", "Occupied Beds" и "Free Beds". За улеснение, може да се натисне "Recalculate Free Beds", което ще изчисли свободните легла от всичките и заетите. Също може да се натисне"Occupy" или "Free a bed", което променя с по 1 свободните и заетите легла (едното за сметка на другото.)
		Ако тези полета не са били добавени в базата от данни, то те ще трябва да се въведат сега (ще са на 0)
		Щом промените са готови, потребителят може да натисне "Upload Information" за да качат тази информация в базата от данни.
	"/User/index.html" - това е публичен линк и може да се отвори от всички
		Който и да отвори този линк, те няма да бъдат помолени за регистрация.
		Списък със всички отделения със свободни легла (freebeds != 0) ще излязат в низходящ ред на свободни легла.
		Тази страница трябва да бъде отворена за всички, включително за широката общественост и медиците от бърза помощ
	"/Util/Audit/index.html" - това е одит на всяка промяна от болниците
		На тази страница потребителят не е помолен да влезе в техният Google профил, но има бутон, който им дава тази възможност.
		Списък с последните X (10 по подразбиране) промени в отделенията, като дните ще са отделени от линия в списъка.
		Стойността X може да бъде променена от потребителя, а също може да мине на следваща и предипна страница.
		Ако имейлът на потребителят е в базата от данни, то заедно със всяка промяна ще излиза и  имейлът на този, който е направил промяната. Това става за да се запази лична информация
	"/Util/PermError" - ако потребител влезе в системата със своят Google профил, но не са в базат от данни, те ще бъдат прехвърлени на тази страница без да имат достъп до важна информация.
	Щом тази страница е отворена, потребителя може да излезе от профила си за да опита отново (в случай, че има грешка)

Всичката информация се записва във Firebase, затова затваряне и рестартиране на апликацията няма да доведе до загуба на информация.

# Лиценз

Проектът се разпространява под лицензът GNU Affero General Public License. Вижте `LICENSE` за повече информация.

# Връзка

Иван Спиров - [ispirovjr@gmail.com](ispirovjr@gmail.com)

Линк към проекта: [https://github.com/ispirovjr/Onlympiad2020](https://github.com/ispirovjr/Onlympiad2020)
